# PRD: JIRA Subtask Sync & Parallel Subtask Execution

## Status: DRAFT
## Author: Generated by AI, owned by human
## Date: 2026-02-20

---

## 1. Problem Statement

When the dev plan contains a deep hierarchy (Epic â†’ Story â†’ Task â†’ Subtask), the `/execute` command creates JIRA issues for all levels including subtasks (x.x.x) via `jira-import.js`, but **never transitions subtask-level JIRA issues** during execution. Subtask JIRA issues remain in their initial status ("To Do") forever, even after the parent task (and all its subtasks) is completed. This makes the JIRA board inaccurate for teams tracking work at the subtask level.

Additionally, subtasks within different tasks that have no cross-dependencies are executed sequentially rather than in parallel, missing an opportunity for faster execution when subtasks are independent.

## 2. Target Users

- **Pipeline operators** who run `/execute` and expect JIRA to accurately reflect progress at all hierarchy levels
- **Project managers / stakeholders** who track progress via JIRA boards at the subtask level
- **Developers** running the pipeline who benefit from faster parallel subtask execution

## 3. Goals

- JIRA subtask issues (x.x.x) are transitioned to "In Progress" when their parent task starts and to "Done" when the parent task completes
- JIRA reconciliation (Step 1.5) also covers subtask-level issues, not just task-level
- Subtasks within a single task that are explicitly independent can optionally be parallelized during the BUILD phase

## 4. Non-Goals (Explicitly Out of Scope)

- Changing the JIRA issue creation logic in `jira-import.js` â€” subtasks are already created correctly
- Adding individual per-subtask PRs or per-subtask Ralph Loop cycles â€” subtasks remain grouped under their parent task's PR
- Tracking subtask status independently in the dev plan â€” subtask status follows parent task status
- Changing the `/plan2jira` command behavior

## 5. User Stories

### US-1: JIRA Subtask Transitions During Execution
**As a** pipeline operator, **I want** JIRA subtask issues to be transitioned to "In Progress" and "Done" alongside their parent task, **so that** the JIRA board accurately reflects progress at the subtask level.

**Acceptance Criteria:**
- [ ] AC 1.1: When a task starts execution (Step 3a), all its subtask JIRA issues are transitioned to "In Progress"
- [ ] AC 1.2: When a task is marked DONE (Step 3g after PR merge), all its subtask JIRA issues are transitioned to "Done"
- [ ] AC 1.3: When a task is escalated/blocked (Step 3e), subtask JIRA issues remain at their current status (no transition)
- [ ] AC 1.4: Transitions are idempotent â€” already-in-target-status subtasks are handled gracefully (no errors)

### US-2: JIRA Subtask Reconciliation on Resume
**As a** pipeline operator, **I want** JIRA subtask statuses to be reconciled during Step 1.5 (like tasks are), **so that** subtask JIRA issues are accurate after session restarts.

**Acceptance Criteria:**
- [ ] AC 2.1: During reconciliation, if a task is marked `âœ… DONE`, all its subtask JIRA issues are also transitioned to "Done"
- [ ] AC 2.2: During reconciliation, if a task is marked `ðŸ”„ IN PROGRESS`, all its subtask JIRA issues are transitioned to "In Progress"
- [ ] AC 2.3: Reconciliation report includes subtask transitions (e.g., "PAR-25 (SUBTASK 1.1.1) â†’ Done")

### US-3: Parallel Subtask Execution Within a Task
**As a** pipeline operator, **I want** independent subtasks within a single task to be executed in parallel when possible, **so that** complex tasks complete faster.

**Acceptance Criteria:**
- [ ] AC 3.1: The BUILD phase prompt instructs the agent to identify independent subtasks and implement them in parallel where safe
- [ ] AC 3.2: Subtasks with explicit ordering dependencies (e.g., "create schema" before "write migration") are still executed sequentially
- [ ] AC 3.3: Default behavior remains sequential (current behavior) â€” parallel subtask execution is opt-in guidance, not enforced

## 6. Functional Requirements

### Must Have (P0)

- FR-1: Update `commands/execute.md` Step 3a to transition all subtask JIRA issues to "In Progress" when a task starts
- FR-2: Update `commands/execute.md` Step 3g to transition all subtask JIRA issues to "Done" when a task completes
- FR-3: Update `commands/execute.md` Step 1.5 to include subtask-level JIRA reconciliation
- FR-4: The `jira-issue-mapping.json` already contains subtask keys (e.g., `SUBTASK-1.1.1 â†’ MVP-104`) â€” no change needed to the mapping file
- FR-5: Use the existing `transition-issue.js` script for subtask transitions â€” no new scripts required

### Should Have (P1)

- FR-6: Update the BUILD phase prompt (Step 3b) to instruct agents to parallelize independent subtasks where safe
- FR-7: Add subtask transition counts to the reconciliation report output

### Nice to Have (P2)

- FR-8: Add a `subtask_jira_sync: true/false` flag in `pipeline.config.yaml` to allow disabling subtask JIRA sync (for projects that don't want subtask-level tracking)

## 7. Acceptance Criteria (Consolidated)

### P0 â€” Must Pass for Launch
- [ ] AC 1.1: Subtask JIRA issues transitioned to "In Progress" when parent task starts
- [ ] AC 1.2: Subtask JIRA issues transitioned to "Done" when parent task completes
- [ ] AC 1.3: Escalated/blocked tasks don't transition subtask JIRA issues
- [ ] AC 1.4: Transitions are idempotent (no errors on already-transitioned)
- [ ] AC 2.1: Reconciliation transitions subtask JIRA issues to "Done" for completed tasks
- [ ] AC 2.2: Reconciliation transitions subtask JIRA issues to "In Progress" for in-progress tasks
- [ ] AC 2.3: Reconciliation report includes subtask transitions

### P1 â€” Should Pass
- [ ] AC 3.1: BUILD prompt includes parallel subtask guidance
- [ ] AC 3.2: Dependent subtasks remain sequential
- [ ] AC 3.3: Parallel subtask execution is opt-in guidance

### P2 â€” Nice to Have
- [ ] FR-8: Config flag for subtask JIRA sync

## 8. Non-Functional Requirements

- **Performance:** Subtask JIRA transitions should not significantly slow down execution. Parallel transition calls where possible.
- **Reliability:** Transition failures for individual subtasks should log warnings but NOT block the parent task's execution.
- **Backwards Compatibility:** Projects without subtasks in their dev plans should be unaffected. Missing subtask keys in `jira-issue-mapping.json` should be silently skipped.

## 9. Testing Strategy

| User Story | Unit | Integration | UI | E2E | Notes |
|-----------|------|-------------|-----|-----|-------|
| US-1 | No | No | No | No | Changes are to command spec (markdown), not code. Validated via manual pipeline run. |
| US-2 | No | No | No | No | Changes are to command spec (markdown), not code. Validated via manual pipeline run. |
| US-3 | No | No | No | No | Changes are to BUILD prompt in command spec. Validated via manual pipeline run. |

Note: All changes are to the `commands/execute.md` specification file and optionally `pipeline.config.yaml` template. These are prompt/instruction changes, not code changes, so automated testing is not applicable. Validation is through a real pipeline run.

## 10. Technical Context & Constraints

- The `jira-issue-mapping.json` already maps subtask IDs to JIRA keys (e.g., `"SUBTASK-1.1.1": "MVP-104"`)
- The `transition-issue.js` script works for any JIRA issue type â€” no special handling needed for subtasks
- Subtask IDs in the mapping follow the pattern `SUBTASK-N.M.P` where `N.M` is the parent task number
- The execute command is a prompt/specification â€” Claude interprets and executes it. Changes to `execute.md` immediately affect behavior.

## 11. Success Metrics

| Metric | Target | Measurement Method |
|--------|--------|--------------------|
| Subtask JIRA accuracy | 100% of subtask issues in correct status after execution | JIRA board inspection post-pipeline run |
| No execution regressions | All existing task-level transitions continue working | Pipeline run comparison |
| Subtask transition failures | 0 blocking failures (warnings OK) | Pipeline execution logs |

## 12. Open Questions

- [x] Should subtask JIRA transitions happen in parallel (faster) or sequentially (safer)? â†’ **In parallel** â€” `transition-issue.js` is idempotent and parallel is faster
- [x] Should blocked/escalated tasks still transition subtasks? â†’ **No** â€” leave subtasks at current status when parent is blocked

## 13. Dependencies & Risks

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| JIRA API rate limiting from many subtask transitions | Medium | Low | transition-issue.js already has retry with backoff |
| Subtask JIRA keys missing from mapping (old imports) | Low | Medium | Silently skip missing keys, log warning |

## 14. Timeline Estimate

- Phase 1: Update execute.md (Steps 1.5, 3a, 3g) â€” 1-2 hours
- Phase 2: Update BUILD prompt for parallel subtask guidance â€” 30 min
- Phase 3: Optional config flag in pipeline.config.yaml template â€” 30 min
