# Pipeline Configuration Template
# Copy this file to your project root as `pipeline.config.yaml` and customize.

pipeline:
  # Project type flags — enable conditional critic agents
  has_frontend: false            # Set true for projects with frontend code (enables Designer Critic)
  has_backend_service: false     # Set true for long-running services: API servers, workers, queue consumers (enables Observability Critic)
  has_api: false                 # Set true for projects exposing or consuming HTTP/GraphQL/gRPC APIs (enables API Contract Critic)

  # JIRA integration
  jira:
    project_key: PROJ           # Your JIRA project key (e.g., MVP, CD)
    host: https://yourteam.atlassian.net
    env_file: .env.jira         # Path to JIRA credentials file

  # Critic validation settings
  validation:
    default_mode: parallel      # parallel | sequential
    max_iterations: 5           # Max iterations for PRD and dev plan Ralph Loops
    escalation: user            # user | skip | fail

  # PRD quality scoring thresholds
  scoring:
    per_critic_min: 8.5         # Minimum score per critic (1-10 scale)
    overall_min: 9.0            # Minimum average across all critics
    # Note: max iterations for PRD scoring uses validation.max_iterations above

    # Per-stage critic overrides
    stages:
      req2prd:
        critics: [product, dev, devops, qa, security, performance, data-integrity, observability, api-contract, designer]  # conditional: observability (has_backend_service), api-contract (has_api), designer (has_frontend)
        mode: parallel
      prd2plan:
        critics: [product, dev, devops, qa, security, performance, data-integrity, observability, api-contract, designer]  # conditional: observability (has_backend_service), api-contract (has_api), designer (has_frontend)
        mode: parallel
      plan2jira:
        critics: [product, dev]
        mode: parallel
        mandatory: true         # Must pass before JIRA creation
      execute:
        critics: [product, dev, devops, qa, security, performance, data-integrity, observability, api-contract, designer]  # conditional: observability (has_backend_service), api-contract (has_api), designer (has_frontend)
        mode: parallel
      pre_merge:
        critics: [dev, devops, security, performance, data-integrity, observability, api-contract, designer]  # conditional: observability (has_backend_service), api-contract (has_api), designer (has_frontend)
        mode: sequential        # DevOps reviews after Dev passes

  # Execution settings
  execution:
    ralph_loop:
      build_models:
        simple: sonnet           # Sonnet 4.6 — Docs, config, small edits
        medium: opus            # Opus 4.6 — Single-file logic, endpoints
        complex: opus           # Opus 4.6 — Multi-file, complex logic
      review_model: opus        # Opus 4.6 — Always reviews with Opus 4.6
      fresh_context: true       # Fresh CLI session per iteration
      max_iterations: 3         # Max build-review cycles
      escalation: user          # user | skip | fail
    parallel_stories: true      # Enable cross-story parallelism
    parallel_tasks: true        # Enable within-story parallelism (respects dependencies)
    subtask_jira_sync: true     # Sync subtask-level (x.x.x) JIRA issues during execution (set false to skip)
    branch_pattern: "feat/story-{S}-task-{T}-{slug}"

  # Test commands (override per project)
  test_commands:
    unit: "npm test"
    integration: "npm run test:integration"
    ui: "npm run test:ui"
    all: "npm run test:all"

  # Test requirements: file pattern → required test types (project defaults)
  # PRD Testing Strategy can override/extend these per feature.
  test_requirements:
    "lib/**/*.js": [unit, integration]
    "public/**": [ui]
    "bq/**/*.sql": [integration]
    "model/**": [schema_validation]
    "scripts/**/*.js": [unit]

  # Project-specific paths (override per project)
  paths:
    prd_dir: "docs/prd"
    dev_plans_dir: "docs/dev_plans"
    agent_constraints: "docs/ai_definitions/AGENT_CONSTRAINTS.md"
    breakdown_definition: "docs/ai_definitions/TASK_BREAKDOWN_DEFINITION.md"
    jira_import: "scripts/jira/jira-import.js"
    jira_transition: "scripts/jira/transition-issue.js"
    validate_breakdown: "scripts/ai_development/validate-breakdown.js"
