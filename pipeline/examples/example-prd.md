# PRD: Daily Revenue Trends by Shift

## Status: APPROVED
## Author: Generated by AI, owned by human
## Date: 2026-02-16

---

## 1. Problem Statement

Restaurant managers currently lack visibility into how revenue fluctuates across different shifts (breakfast, lunch, dinner). They rely on end-of-day totals, making it impossible to identify underperforming shifts, allocate staff efficiently, or detect trends like declining lunch revenue. We need this now because Q1 planning requires shift-level data for staffing decisions.

## 2. Target Users

- **Restaurant managers**: Need daily visibility into shift performance to make staffing and operational decisions
- **Regional directors**: Need to compare shift performance across stores for benchmarking
- **Operations team**: Need trend data for capacity planning and menu optimization

## 3. Goals

- Enable managers to view revenue broken down by shift (breakfast, lunch, dinner) for any date range
- Surface trends (7-day, 30-day) so managers can spot declining/growing shifts
- Reduce time-to-insight from "end of month reports" to "daily dashboard check"

## 4. Non-Goals (Explicitly Out of Scope)

- Real-time revenue streaming (batch daily is sufficient)
- Individual transaction-level drill-down
- Revenue forecasting or predictions (separate initiative)
- Menu-item-level revenue breakdown (future enhancement)

## 5. User Stories

### US-1: View daily revenue by shift
**As a** restaurant manager, **I want** to see today's revenue broken down by breakfast, lunch, and dinner shifts, **so that** I can quickly assess each shift's performance.

**Acceptance Criteria:**
- [ ] AC 1.1: Dashboard shows revenue for breakfast (6am-11am), lunch (11am-4pm), dinner (4pm-close) shifts
- [ ] AC 1.2: Revenue values update daily by 2am for the previous day
- [ ] AC 1.3: Each shift shows total revenue, transaction count, and average ticket size

### US-2: View revenue trends over time
**As a** restaurant manager, **I want** to see 7-day and 30-day revenue trends per shift, **so that** I can identify patterns and take corrective action.

**Acceptance Criteria:**
- [ ] AC 2.1: Line chart shows daily revenue per shift for selected date range
- [ ] AC 2.2: Trend indicators (up/down/flat) shown for each shift comparing to prior period
- [ ] AC 2.3: Date range selector allows custom range up to 90 days

### US-3: Compare shifts across stores
**As a** regional director, **I want** to compare shift revenue across my stores, **so that** I can identify best practices and underperformers.

**Acceptance Criteria:**
- [ ] AC 3.1: Table view shows all stores with revenue per shift as columns
- [ ] AC 3.2: Sortable by any shift's revenue (ascending/descending)
- [ ] AC 3.3: Stores flagged when any shift is >20% below regional average

## 6. Functional Requirements

### Must Have (P0)
- Shift-level revenue aggregation from transaction data
- Daily dashboard showing current and previous day by shift
- 7-day and 30-day trend visualization per shift
- Store-level data access (managers see only their store)

### Should Have (P1)
- Cross-store comparison view for regional directors
- Export to CSV for selected date range
- Shift boundary configuration per store (not all stores have same shift times)

### Nice to Have (P2)
- Email digest with daily shift summary
- Anomaly highlighting (shifts significantly above/below normal)

## 7. Acceptance Criteria (Consolidated)

### P0 — Must Pass for Launch
- [ ] AC 1.1: Dashboard shows revenue for breakfast, lunch, dinner shifts
- [ ] AC 1.2: Revenue values update daily by 2am
- [ ] AC 1.3: Each shift shows total revenue, transaction count, avg ticket
- [ ] AC 2.1: Line chart shows daily revenue per shift for date range
- [ ] AC 2.2: Trend indicators shown per shift
- [ ] AC 2.3: Date range selector up to 90 days

### P1 — Should Pass
- [ ] AC 3.1: Cross-store table view with per-shift columns
- [ ] AC 3.2: Sortable by shift revenue
- [ ] AC 3.3: Flagging for stores >20% below regional average
- [ ] CSV export for date range

### P2 — Nice to Have
- [ ] Email digest
- [ ] Anomaly highlighting

## 8. Non-Functional Requirements

- **Performance**: Dashboard loads in < 2 seconds for up to 90 days of data
- **Security**: Store-level data access control (managers see only their store, directors see their region)
- **Scalability**: Supports up to 500 stores without degradation
- **Accessibility**: WCAG 2.1 AA compliance for dashboard

## 9. Testing Strategy

| User Story | Unit | Integration | UI | E2E | Notes |
|-----------|------|-------------|-----|-----|-------|
| US-1 | Yes | Yes (BQ queries) | Yes (dashboard) | No | Core data pipeline + display |
| US-2 | Yes | Yes (BQ queries) | Yes (charts) | No | Trend calculations + visualization |
| US-3 | Yes | Yes (BQ queries) | Yes (table) | No | Cross-store queries + comparison logic |

## 10. Technical Context & Constraints

- Revenue data lives in BigQuery `transactions` table
- Shift boundaries defined in `config/store-locations.json`
- Frontend uses vanilla JS with Chart.js for visualizations
- API built on Express.js, data accessed via Cube.js
- Must reuse existing auth middleware for store-level access control

## 11. Success Metrics

| Metric | Target | Measurement Method |
|--------|--------|--------------------|
| Dashboard adoption | 80% of managers use weekly within 30 days | Analytics tracking |
| Time-to-insight | < 30 seconds from login to shift view | UX observation |
| Data freshness | Updated by 2am daily, 99.5% reliability | Monitoring alerts |
| Page load time | < 2 seconds p95 | Performance monitoring |

## 12. Open Questions

- [ ] Should shift boundaries be configurable per store or use global defaults initially?
- [ ] What date should we use for "revenue date" — transaction time or settlement time?
- [ ] Do we need to handle time zones for multi-region deployments?

## 13. Dependencies & Risks

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| Transaction data quality issues | High | Medium | Add data validation in ETL, alert on anomalies |
| Shift boundary edge cases (transactions spanning shifts) | Medium | High | Assign to shift based on transaction start time |
| BQ query costs for large date ranges | Medium | Low | Use partitioned tables, cache common queries |
| Chart.js performance with 90 days x 3 shifts | Low | Medium | Aggregate to weekly for ranges > 30 days |

## 14. Timeline Estimate

- Phase 1 (Week 1-2): Data pipeline — BQ schema, ETL, shift aggregation
- Phase 2 (Week 2-3): API endpoints — Cube.js measures, Express routes
- Phase 3 (Week 3-4): Frontend — Dashboard, charts, cross-store view
- Phase 4 (Week 4): Testing, polish, documentation
